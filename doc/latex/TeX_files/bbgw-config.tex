%    Documentation for PRU ADC Project
%    Copyright (C) 2016  Gregory Raven
%
%    This program is free software: you can redistribute it and/or modify
%    it under the terms of the GNU General Public License as published by
%    the Free Software Foundation, either version 3 of the License, or
%    (at your option) any later version.
%
%    This program is distributed in the hope that it will be useful,
%    but WITHOUT ANY WARRANTY; without even the implied warranty of
%    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
%    GNU General Public License for more details.
%
%    You should have received a copy of the GNU General Public License
%    along with this program.  If not, see <http://www.gnu.org/licenses/>.

\chapter{Configuration of the Beagle Bone Green Wireless}

The default configuration of the Beagle Bone Green Wireless is as a ``access 
point'' (a wireless router).  This is not a desired configuration for a 
dedicated embedded device as used in this project.

The following process re-configures the BBGW to a non-access point mode.

The goal is to have a working wireless substitute for the ethernet connector 
which does not exist on the BeagleBone Green Wireless.
This is as a typical "headless" embedded project with the primary access using 
a terminal and ssh.

Download and expand the IOT bone image per this link and flash to micro-sd.  I 
used this one:

\url{https://debian.beagleboard.org/images/bone-debian-8.7-iot-armhf-2017-03-19-4gb.img.xz}

Write the image to the micro-sd (I put the micro-sd in a USB adapter plugged 
into my Ubuntu workstation):

\begin{verbatim}
sudo dd if=bone-debian-8.7-iot-armhf-2017-01-15-4gb.img of=/def/sdb bs=8M
\end{verbatim}

Eject the micro-sd from workstation and insert in the BBGW micro-sd slot.
Connect a USB 3.3V serial device to the "debug serial header".  The USB network 
connection could be substituted, however, my experience
with this is that using the serial device is solid and will work consistently.
Also, since the BBGW doesn't have a dedicated power connector.  It uses the 
micro-USB.
It is my preference to use a high-current dedicated USB power supply and ignore 
this as a possible network connection.

Power-up the BBGW and wait for the boot process to complete.
Open a (bash) terminal and use the screen utility to connect via the serial USB 
device.

\begin{verbatim}
screen /dev/ttyUSB0 115200
\end{verbatim}

I had to hit enter after the above command to get to the login prompt.
The login user is debian and the password is temppwd.

You may have to install screen:

\begin{verbatim}
sudo apt-get install screen
\end{verbatim}

After logging in, a good thing to do first is to run this shell script:

\begin{verbatim}
cd /opt/scripts/tools
sudo ./grow_partition.sh
\end{verbatim}

Next:

\begin{verbatim}
ifconfig
\end{verbatim}

You should see 4 different network resources (not showing the full output here):

\begin{verbatim}
SoftAp0
lo
usb0
wlan0
\end{verbatim}

The network resource SoftAp0 represents an "access point".
The BBGW is configured as a wireless router!
That is not the desired configuration, and fortunately this is easily removed.
Edit the file:

\begin{verbatim}
/etc/default/bb-wl18xx
\end{verbatim}

Change the line:

\begin{verbatim}
TETHER_ENABLED=yes
\end{verbatim}

to

\begin{verbatim}
TETHER_ENABLED=no
\end{verbatim}

Save and exit, and reboot, and login.

ifconfig should now show only 3:  lo, usb0, and wlan0.

Now to configure WIFI!  It is assumed you have a home wireless router and you 
know the SSID and passphrase.
The router should be configured for DHCP (automatic assignment of IP addresses).
From a terminal:

\begin{verbatim}
sudo connmanctl
connmanctl> scan wifi
Scan completed for wifi
connmanctl> services
    (your router broadcast)         (router info)
connmanctl> agent on
Agent registered
connmanctl> connect (copy router info here)
Agent RequestInput (router info)
  Passphrase = [ Type=psk, Requirement=mandatory, Alternates=[ WPS ] ]
  WPS = [ Type=wpspin, Requirement=alternate ]
Passphrase? (your passphrase)
Connected (router info)
connmanctl> quit
\end{verbatim}

The above configuration is permanent and will survive reboot.
An outstanding page with good info on connman:

\url{https://wiki.archlinux.org/index.php/Connman}

Another very good thing is to login to your router and use this to determine if 
your BBGW is successfully connected.
And remember the router may have security settings which may block it from 
connecting.
Also, rather than attempting to force a fixed IP address on the BBGW, I used 
the "address reservation" feature
so that the IP address assigned by the router will be the same each time it 
connects.  This is done using the MAC address of the BBGW.

After the above configuration is done, shutdown and remove the USB serial 
device.
Power up the BBGW and wait for it to boot, and then using a terminal and ssh 
you should be able to connect to the BBGW as if an ethernet cable was connected:

ssh debian@(the assigned IP address)

After logging in you should have internet connectivity, so don't forget to:

sudo apt-get update

Here is an example USB serial device.  This should be on your tool kit list:

\url{https://www.amazon.com/gp/product/B01AFQ00G2/ref=oh_aui_search_detailpage?ie=UTF8&psc=1}







